FROM vm/ubuntu:18.04

# Install node
RUN curl -sL https://deb.nodesource.com/setup_12.x | bash
RUN apt install nodejs

# Install Doppler
RUN (curl -Ls https://cli.doppler.com/install.sh || wget -qO- https://cli.doppler.com/install.sh) | sh

COPY . .

# Load DOPPLER_TOKEN secret from LayerCI
SECRET ENV DOPPLER_TOKEN

# Run server with Doppler
RUN BACKGROUND doppler run -- node server.js
EXPOSE WEBSITE http://localhost:3000
